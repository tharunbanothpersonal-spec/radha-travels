<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Reset Admin Password</title>
  <style>
    body{font-family:sans-serif;padding:20px}
    .box{max-width:420px;margin:40px auto;padding:20px;border-radius:8px;border:1px solid #eee}
    input{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ddd}
    button{background:#2b7a3a;color:#fff;padding:10px 14px;border:none;border-radius:6px;cursor:pointer}
    .msg{margin-top:12px}
  </style>
</head>
<body>
  <div class="box">
    <h3>Reset Password</h3>
    <input id="newPwd" type="password" placeholder="New password (min 8 chars)" />
    <input id="confirmPwd" type="password" placeholder="Confirm new password" />
    <button id="submitBtn">Reset password</button>
    <div id="msg" class="msg"></div>
  </div>

  <script>
    function qs(name){ const params = new URLSearchParams(window.location.search); return params.get(name) || ''; }
    const token = qs('token');
    document.getElementById('submitBtn').addEventListener('click', async ()=>{
      const newPwd = document.getElementById('newPwd').value;
      const confirmPwd = document.getElementById('confirmPwd').value;
      const msg = document.getElementById('msg');
      if (!newPwd || newPwd.length < 8) { msg.style.color='#b00'; msg.textContent='Password must be 8+ chars'; return; }
      if (newPwd !== confirmPwd) { msg.style.color='#b00'; msg.textContent='Passwords do not match'; return; }
      try {
        const res = await fetch('/admin/auth/reset-password', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ token, newPassword: newPwd })
        });
        const data = await res.json();
        if (!res.ok || !data.ok) {
          msg.style.color='#b00'; msg.textContent = data && (data.error || data.message) ? (data.error || data.message) : 'Reset failed';
          return;
        }
        msg.style.color='#080'; msg.textContent='Password reset successful. Redirecting to login...';
        setTimeout(()=> window.location.href='/', 1000);
      } catch (e) {
        msg.style.color='#b00'; msg.textContent='Network error';
      }
    });
  </script>
</body>
</html>
